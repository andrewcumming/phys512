

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Metropolis-Hastings algorithm &#8212; PHYS 512 Computational Physics with Applications</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'metropolis';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Solutions to exercises" href="random_solutions.html" />
    <link rel="prev" title="Monte Carlo integration" href="monte_carlo_integration.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/plasma.png" class="logo__image only-light" alt="PHYS 512 Computational Physics with Applications - Home"/>
    <script>document.write(`<img src="_static/plasma.png" class="logo__image only-dark" alt="PHYS 512 Computational Physics with Applications - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">About the course</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="outline.html">Course outline</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="basics.html">Getting set up</a></li>
<li class="toctree-l1"><a class="reference internal" href="programming.html">Programming best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="floats.html">Floating point arithmetic</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Manipulating functions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="derivatives.html">Derivatives</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolation.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Integration</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="function_solutions.html">Solutions to exercises</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="derivatives_solutions.html">Derivatives exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="interpolation_solutions.html">Interpolation exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="integration_solutions.html">Integration exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Random numbers</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="random.html">Random numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcg.html">Linear Congruential Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating_random.html">Probability distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="monte_carlo_integration.html">Monte Carlo integration</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Metropolis-Hastings algorithm</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="random_solutions.html">Solutions to exercises</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="prob_distributions_solutions.html">Probability distributions Exercise 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="prob_distributions_solutions_part2.html">Probability distributions Part 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="montecarlo_solutions.html">Monte Carlo Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="metropolis_solutions.html">Metropolis-Hastings</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Solving systems of equations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="matrices.html">Matrices in numpy</a></li>

<li class="toctree-l1"><a class="reference internal" href="linear_least_squares.html">Linear least squares</a></li>
<li class="toctree-l1"><a class="reference internal" href="polynomial_fit.html">Polynomial fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="nonlinear.html">Non-linear least squares</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="solving_solutions.html">Solutions to exercises</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="polynomial_fit_solutions.html">Orthogonal polynomials</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonlinear_fit.html">Lorentzian fit</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="mllecture.html">Machine Learning</a></li>

<li class="toctree-l1"><a class="reference internal" href="chatgpt.html">ChatGPT ‘Real-Life Example’</a></li>
<li class="toctree-l1"><a class="reference internal" href="mltensorflow.html">Example : Higgs Boson</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Differential equations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="runge_kutta.html">Initial value problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="boundary_value_problems.html">Boundary value problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="symplectic.html">Symplectic integrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="laplace.html">Poisson’s equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="conjugate_gradient.html">Sparse matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="numerical_instability.html">Boundary conditions and numerical stability</a></li>
<li class="toctree-l1"><a class="reference internal" href="diffusion.html">Diffusion in multi-dimensions</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="ode_solutions.html">Solutions to exercises</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="runge_kutta_solutions.html">Initial value problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="bvps.html">Boundary value problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="symplectic_solutions.html">Symplectic integrators</a></li>
<li class="toctree-l2"><a class="reference internal" href="conjugate_gradient_solutions.html">Conjugate gradient solutions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Homework</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="hw1.html">Homework 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="hw2.html">Homework 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="hw3.html">Homework 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="hw4.html">Homework 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="hw5.html">Homework 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="hw6.html">Homework 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_instructions.html">Project Instructions</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="homework_solutions.html">Homework solutions</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="HW1_solutions.html">Homework 1 solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="HW2_solutions.html">Homework 2 solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="homework_notes/hw2_common_issues.html">Homework 2: Common Issues</a></li>














<li class="toctree-l2"><a class="reference internal" href="HW3_solutions.html">Homework 3 solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="HW4_solutions.html">Homework 4 solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="HW5_solutions.html">Homework 5 solutions</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/andrewcumming/phys512" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/andrewcumming/phys512/issues/new?title=Issue%20on%20page%20%2Fmetropolis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/metropolis.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Metropolis-Hastings algorithm</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-data-to-constrain-model-parameters-with-mcmc">Using data to constrain model parameters with MCMC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-exoplanet-hunting-with-radial-velocities">Example: Exoplanet hunting with radial velocities</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="metropolis-hastings-algorithm">
<h1>Metropolis-Hastings algorithm<a class="headerlink" href="#metropolis-hastings-algorithm" title="Permalink to this heading">#</a></h1>
<p>Another way to sample a probability distribution is to use a <strong>Markov Chain Monte Carlo</strong> method. In these methods, we generate a sequence (or chain) of <span class="math notranslate nohighlight">\(x\)</span> values that sample a given probability distribution <span class="math notranslate nohighlight">\(f(x)\)</span>. Each sample <span class="math notranslate nohighlight">\(x_i\)</span> is generated from the previous one <span class="math notranslate nohighlight">\(x_{i-1}\)</span> in some probabilistic way, so <span class="math notranslate nohighlight">\(x_i\)</span> depends only on the state before it <span class="math notranslate nohighlight">\(x_{i-1}\)</span> (this is the Markov chain part). By choosing the dependence of <span class="math notranslate nohighlight">\(x_i\)</span> on <span class="math notranslate nohighlight">\(x_{i-1}\)</span> in an appropriate way, we can generate a sequence <span class="math notranslate nohighlight">\(\{x_i\}\)</span> that are random samples from any given probability distribution <span class="math notranslate nohighlight">\(f(x)\)</span>.</p>
<p>The <strong>Metropolis-Hastings algorithm</strong> is a simple method to do this. To generate the next value in  the chain <span class="math notranslate nohighlight">\(x_{i+1}\)</span> given the current value <span class="math notranslate nohighlight">\(x_i\)</span>, the procedure is as follows:</p>
<ol class="arabic simple">
<li><p>Propose a jump from the current value <span class="math notranslate nohighlight">\(x_i=x\)</span> to a new candidate value <span class="math notranslate nohighlight">\(x^\prime\)</span> according to a proposal distribution <span class="math notranslate nohighlight">\(p(x^\prime|x)\)</span>. The proposal distribution should be symmetric, ie. the probability of choosing a new  location <span class="math notranslate nohighlight">\(x^\prime\)</span> given that we are now at <span class="math notranslate nohighlight">\(x\)</span> should be the same as the probability of choosing <span class="math notranslate nohighlight">\(x\)</span> if we were located at <span class="math notranslate nohighlight">\(x^\prime\)</span>. For example, in 1D we could choose <span class="math notranslate nohighlight">\(x^\prime = x_i + \Delta x\)</span> with <span class="math notranslate nohighlight">\(\Delta x\)</span> drawn from a Gaussian distribution.</p></li>
<li><p>Evaluate the ratio <span class="math notranslate nohighlight">\(\alpha = f(x^\prime)/f(x)\)</span>. If <span class="math notranslate nohighlight">\(\alpha&gt;1\)</span>, ie. the new point is located in a region with larger <span class="math notranslate nohighlight">\(f(x)\)</span>, then we accept the move and set <span class="math notranslate nohighlight">\(x_{i+1} = x^\prime\)</span>. If <span class="math notranslate nohighlight">\(\alpha&lt;1\)</span>, we accept the move with probability <span class="math notranslate nohighlight">\(\alpha\)</span>. If the move is rejected, then we set <span class="math notranslate nohighlight">\(x_{i+1} = x_i\)</span>.  (Note that this entire step can be achieved by choosing a uniform deviate <span class="math notranslate nohighlight">\(u\)</span> between 0 and 1, and accepting the move if <span class="math notranslate nohighlight">\(u&lt;\alpha\)</span>.)</p></li>
</ol>
<p>The size of the jump in step 1 is set by the width of the Gaussian used to sample the jump size <span class="math notranslate nohighlight">\(\Delta x\)</span>. The width should be chosen so that a reasonable number of trial jumps are accepted. Typically an acceptance fraction of <span class="math notranslate nohighlight">\(\approx 0.25\)</span> is a good choice.</p>
<p>After an initial <em>burn-in</em> phase, the chain will reach equilibrium and the samples <span class="math notranslate nohighlight">\(\{x_i\}\)</span> will be distributed according to the probability distribution <span class="math notranslate nohighlight">\(f(x)\)</span>. The reason this works is that in equilibrium, the rate at which we move from point <span class="math notranslate nohighlight">\(x\)</span> to <span class="math notranslate nohighlight">\(x^\prime\)</span> should be equal to the rate at which we move in the reverse direction, from <span class="math notranslate nohighlight">\(x^\prime\)</span> to <span class="math notranslate nohighlight">\(x\)</span>. This is the principle of <em>detailed balance</em>. Balancing the forward and backward rates gives</p>
<div class="math notranslate nohighlight">
\[n(x) \times (\mathrm{jump\ probability\ from}\ x\rightarrow x^\prime)\]</div>
<div class="math notranslate nohighlight">
\[=
n(x^\prime) \times (\mathrm{jump\ probability\ from}\ x^\prime\rightarrow x),
\]</div>
<p>where <span class="math notranslate nohighlight">\(n(x)\)</span> is the density of points at <span class="math notranslate nohighlight">\(x\)</span>.
If <span class="math notranslate nohighlight">\(x^\prime\)</span> has a larger value of the probability <span class="math notranslate nohighlight">\(f(x^\prime)&gt;f(x)\)</span>, then the transition from <span class="math notranslate nohighlight">\(x\)</span> to <span class="math notranslate nohighlight">\(x^\prime\)</span> will always happen (we always accept), i.e. the rate is 1. The rate of the reverse transition from <span class="math notranslate nohighlight">\(x^\prime\)</span> to <span class="math notranslate nohighlight">\(x\)</span> is then <span class="math notranslate nohighlight">\(f(x)/f(x^\prime)&lt;1\)</span>. Therefore</p>
<div class="math notranslate nohighlight">
\[n(x) = n(x^\prime) f(x)/f(x^\prime)\]</div>
<div class="math notranslate nohighlight">
\[{n(x)\over n(x^\prime)}= {f(x)\over f(x^\prime)}\]</div>
<p>which shows that <span class="math notranslate nohighlight">\(n(x)\)</span> will be distributed as <span class="math notranslate nohighlight">\(f(x)\)</span>.</p>
<div class="admonition-exercise-sampling-exp-x-3-with-metropolis-hastings admonition">
<p class="admonition-title">Exercise: Sampling <span class="math notranslate nohighlight">\(\exp(-|x^3|)\)</span> with Metropolis-Hastings</p>
<p>Code up this algorithm and generate <span class="math notranslate nohighlight">\(10^4\)</span> samples from the distribution <span class="math notranslate nohighlight">\(f(x) = \exp(-\left|x^3\right|)\)</span>. Confirm that you are getting the correct distribution by comparing the histogram of <span class="math notranslate nohighlight">\(x\)</span>-values with the analytic expression.</p>
<p>Plot the values <span class="math notranslate nohighlight">\(\{x_i\}\)</span> against iteration number <span class="math notranslate nohighlight">\(i\)</span>, and plot <span class="math notranslate nohighlight">\(x_i\)</span> against <span class="math notranslate nohighlight">\(x_{i+1}\)</span> for the values in the chain. What do you notice?</p>
<p>How do your results change when you take different values for the width of the proposal distribution?</p>
<p>Also, investigate what happens when you change your starting value of <span class="math notranslate nohighlight">\(x\)</span>. How long does it take for the chain to reach equilibrium?</p>
<p>Compare your results with the same plots for <span class="math notranslate nohighlight">\(10^4\)</span> values from <span class="math notranslate nohighlight">\(f(x)\)</span> chosen by the rejection method.</p>
</div>
<section id="using-data-to-constrain-model-parameters-with-mcmc">
<h2>Using data to constrain model parameters with MCMC<a class="headerlink" href="#using-data-to-constrain-model-parameters-with-mcmc" title="Permalink to this heading">#</a></h2>
<p>A common application of MCMC methods is in fitting models to data and constraining model parameters. Imagine that you have a set of measurements <span class="math notranslate nohighlight">\(\{y_i\}\)</span> and a model that makes a prediction for each measurement <span class="math notranslate nohighlight">\(m_i(\vec{a})\)</span>, where <span class="math notranslate nohighlight">\(\vec{a}=(a_1, a_2, ...)\)</span> are the parameters of the model.
Assuming that the errors are Gaussian with standard deviation <span class="math notranslate nohighlight">\(\sigma_i\)</span> for measurement <span class="math notranslate nohighlight">\(i\)</span>, the probability of getting the data given a set of model parameters <span class="math notranslate nohighlight">\(\vec{a}\)</span>, ie. the <strong>likelihood</strong>, is</p>
<div class="math notranslate nohighlight">
\[\mathrm{Prob}\left(\{y_i\} | \vec{a}   \right) \propto  \prod_i \exp\left(-{(y_i-m_i(\vec{a}))^2\over 2\sigma_i^2}\right) \]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[\mathrm{Prob}\left(\{y_i\} | \vec{a}   \right) \propto  \exp\left(-  \sum_i {(y_i-m_i(\vec{a}))^2\over 2\sigma_i^2}\right) = \exp\left(-{\chi^2(\vec{a})\over 2}\right).\]</div>
<p>Minimizing <span class="math notranslate nohighlight">\(\chi^2\)</span> maximizes the likelihood, so one approach is to find the set of parameters that minimize <span class="math notranslate nohighlight">\(\chi^2\)</span>: these are the best fit parameters. But we can also view the likelihood as telling us the probability of different parameter choices. If we sample from this probability distribution, we can generate the distribution of parameters <span class="math notranslate nohighlight">\(\vec{a}\)</span> consistent with the data. This not only shows us what the best fit parameters are (maximum likelihood), but we can also do things like calculate the mean value of different parameters given their distribution, or look at the width of the distribution to estimate the error in the best fit parameters, or look for correlations between parameters.</p>
<p>There’s one additional subtlety to mention: the likelihood is the probability of the data given the model, but we really want to know the probability of the model given the data.
In Bayesian statistics, this is called the <strong>posterior</strong>, and is the product of the <strong>prior</strong> (probability of the parameters <span class="math notranslate nohighlight">\(\vec{a}\)</span>) and the likelihood, i.e. <span class="math notranslate nohighlight">\(\mathrm{Prob}(\vec{a}|\{y_i\}) \propto \mathrm{Prob}(\vec{a})\mathrm{Prob}\left(\{y_i\} | \vec{a}   \right)\)</span>. The prior summarizes our prior knowledge about the parameters <span class="math notranslate nohighlight">\(\vec{a}\)</span>. Here for simplicity, we will assume that all priors are uniform, so that</p>
<div class="math notranslate nohighlight">
\[\mathrm{Prob}\left(\vec{a}|\{y_i\}\right)\propto  \exp\left(-{\chi^2(\vec{a})\over 2}\right).\]</div>
<p>To find the constraints on the model parameters, we can use MCMC to draw samples of <span class="math notranslate nohighlight">\(\vec{a}\)</span> from this probability distribution.</p>
<section id="example-exoplanet-hunting-with-radial-velocities">
<h3>Example: Exoplanet hunting with radial velocities<a class="headerlink" href="#example-exoplanet-hunting-with-radial-velocities" title="Permalink to this heading">#</a></h3>
<p>The example we will look at is using measurements of the radial velocity wobble of a star to infer the properties of an orbiting exoplanet. if the exoplanet is in an eccentric orbit, we need 6 parameters to describe the radial velocity of the star:</p>
<ul class="simple">
<li><p>the orbital period <span class="math notranslate nohighlight">\(P\)</span> (in days)</p></li>
<li><p>the planet mass <span class="math notranslate nohighlight">\(M_P\)</span> (in Jupiter masses)</p></li>
<li><p>the eccentricity <span class="math notranslate nohighlight">\(e\)</span> (from 0 for circular orbits to a maximum of 1)</p></li>
<li><p>argument of periastron <span class="math notranslate nohighlight">\(\omega\)</span> (in radians) (this determines the orientation of the ellipse relative to the plane of the sky)</p></li>
<li><p>the time of pericenter (days)</p></li>
<li><p>an overall velocity offset (m/s)</p></li>
</ul>
<p>where we’ve also given the units we’ll use for each.</p>
<p>The following function returns the radial velocity for a set of times <code class="docutils literal notranslate"><span class="pre">t</span></code>, orbital period <code class="docutils literal notranslate"><span class="pre">P</span></code> and the remaining parameters in the vector <code class="docutils literal notranslate"><span class="pre">x</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rv</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="c1"># Calculates the radial velocity of a star orbited by a planet</span>
    <span class="c1"># at the times in the vector t</span>
    
    <span class="c1"># extract the orbit parameters</span>
    <span class="c1"># P, t and tp in days, mp in Jupiter masses, v0 in m/s  </span>
    <span class="n">mp</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">x</span>
        
    <span class="c1"># mean anomaly</span>
    <span class="n">M</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="n">P</span>
    
    <span class="c1"># velocity amplitude</span>
    <span class="n">K</span> <span class="o">=</span> <span class="mi">204</span> <span class="o">*</span> <span class="n">P</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">mp</span>  <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">e</span><span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="c1"># m/s</span>
    
    <span class="c1"># solve Kepler&#39;s equation for the eccentric anomaly E - e * np.sin(E) = M</span>
    <span class="c1"># Iterative method from Heintz DW, &quot;Double stars&quot;, Reidel, 1978</span>
    <span class="c1"># first guess</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">M</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>  <span class="o">+</span> <span class="p">((</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="n">E</span> 
        <span class="n">M0</span> <span class="o">=</span> <span class="n">E0</span> <span class="o">-</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">E0</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">E0</span> <span class="o">+</span> <span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">M0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">E0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">E</span><span class="o">-</span><span class="n">E0</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
            <span class="k">break</span>
        
    <span class="c1"># evaluate the velocities</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">e</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">E</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">vel</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">K</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span> <span class="o">+</span> <span class="n">omega</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">vel</span>
</pre></div>
</div>
<p>In the following exercise, you will put this to work to model some actual radial velocity data and constrain the orbital parameters of the planet.</p>
<div class="admonition-exercise-exoplanet-orbit-fit admonition">
<p class="admonition-title">Exercise: exoplanet orbit fit</p>
<p>The file <a class="reference external" href="https://github.com/andrewcumming/phys512/blob/main/rvs.txt">rvs.txt</a> contains a set of radial velocity data for an exoplanet. You can read in this data using</p>
<p><code class="docutils literal notranslate"><span class="pre">tobs,</span> <span class="pre">vobs,</span> <span class="pre">eobs</span> <span class="pre">=</span> <span class="pre">np.loadtxt('rvs.txt',</span> <span class="pre">unpack=True)</span></code></p>
<p>which will give you the observation times <code class="docutils literal notranslate"><span class="pre">tobs</span></code>, the velocities <code class="docutils literal notranslate"><span class="pre">vobs</span></code> and the error for each measurement <code class="docutils literal notranslate"><span class="pre">eobs</span></code>.</p>
<p>The orbital period of this planet is <span class="math notranslate nohighlight">\(P=1724\)</span> days. Use MCMC to find the remaining 5 parameters of the orbit <span class="math notranslate nohighlight">\((M_P, e, \omega_P, t_0, v_0)\)</span>.</p>
<p>Plot the chain of each of the 5 parameters and identify the burn-in phase.</p>
<p>Plot the radial velocity curve <span class="math notranslate nohighlight">\(v(t)\)</span> corresponding to the last set of parameters in your chain and make sure it goes through the data points.</p>
<p>Plot histograms of the 5 parameters. Also look at 2D histograms for different pairs of parameters: do you see any correlations between parameters?</p>
</div>
<p>Some hints for this exercise:</p>
<ul class="simple">
<li><p>Change only one parameter at a time when you make a step in the MCMC. This will lead to a higher acceptance fraction. Each time you make a step, you can select one of the parameters at random and change only that one.</p></li>
<li><p>You can use a Gaussian proposal distribution for each parameter. Good choices for the widths of the Gaussians for the parameters <span class="math notranslate nohighlight">\((M_P, e, \omega_P, t_0, v_0)\)</span> are <span class="math notranslate nohighlight">\((0.03, 0.03, 0.03, 3.0, 1.0)\)</span>.</p></li>
<li><p>If you define the numpy array <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">np.zeros((N,</span> <span class="pre">5))</span></code> then you can use <code class="docutils literal notranslate"><span class="pre">x[i]</span></code> to access the parameters for iteration <code class="docutils literal notranslate"><span class="pre">i</span></code>. (<code class="docutils literal notranslate"><span class="pre">N</span></code> here is the number of iterations)</p></li>
<li><p>Rather than take the ratio of <span class="math notranslate nohighlight">\(e^{-\chi^2/2}\)</span> before and after the jump, it is better to write the ratio of probabilities as <span class="math notranslate nohighlight">\(e^{-\Delta\chi^2/2}\)</span> to avoid overflow/underflow errors.</p></li>
<li><p>To visualize your results, you can use <a class="reference external" href="https://corner.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">corner</span></code></a> to plot a “triangle” plot. If you don’t have this installed, try <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">corner</span></code>. If your samples are in the vector <code class="docutils literal notranslate"><span class="pre">x</span></code>, then you can use</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">corner</span>
<span class="n">figure</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> 
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$M/M_J$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\omega$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t_P$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$v_0$&#39;</span><span class="p">],</span> 
        <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="monte_carlo_integration.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Monte Carlo integration</p>
      </div>
    </a>
    <a class="right-next"
       href="random_solutions.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Solutions to exercises</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-data-to-constrain-model-parameters-with-mcmc">Using data to constrain model parameters with MCMC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-exoplanet-hunting-with-radial-velocities">Example: Exoplanet hunting with radial velocities</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By <a href="https://www.physics.mcgill.ca/~cumming/">Andrew Cumming</a>
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, CC BY SA 4.0.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>